<?xml version="1.0"?>
<rss version="2.0">
    <channel>
        <title>SnowRoll Blog • Posts by &#34;powershell&#34; tag</title>
        <link>https://snowroll.github.io</link>
        <description>分享经验，记录生活</description>
        <language>zh-CN</language>
        <pubDate>Wed, 31 Aug 2022 15:16:53 +0000</pubDate>
        <lastBuildDate>Wed, 31 Aug 2022 15:16:53 +0000</lastBuildDate>
        <category>python</category>
        <category>codeql</category>
        <category>crypto</category>
        <category>Line By Line</category>
        <category>paper</category>
        <category>basketball</category>
        <category>read</category>
        <category>chatgpt</category>
        <category>crawler</category>
        <category>dockerß</category>
        <category>email</category>
        <category>github page</category>
        <category>gitlab</category>
        <category>linux</category>
        <category>heartbeat, java</category>
        <category>latex</category>
        <category>shell</category>
        <category>markdown</category>
        <category>mongodb</category>
        <category>photograph</category>
        <category>powershell</category>
        <category>reverse-shell</category>
        <category>mail</category>
        <category>except</category>
        <category>java</category>
        <category>travel</category>
        <item>
            <guid isPermalink="true">https://snowroll.github.io/powershell-amsi-trace/</guid>
            <title>利用事件写入捕获AMSI实际检测内容</title>
            <link>https://snowroll.github.io/powershell-amsi-trace/</link>
            <category>powershell</category>
            <pubDate>Wed, 31 Aug 2022 15:16:53 +0000</pubDate>
            <description><![CDATA[ &lt;h1 id=&#34;动机&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#动机&#34;&gt;#&lt;/a&gt; 动机&lt;/h1&gt;
&lt;p&gt;在 PowerShell 命令行中执行 PowerShell 脚本时，windows 默认会将执行的内容传送给 AMSI 进行检测，如果检测结果认为执行内容中包含病毒，则拒绝执行，实现安全防护。&lt;/p&gt;
&lt;p&gt;AMSI 的&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly9kb2NzLm1pY3Jvc29mdC5jb20vZW4tdXMvd2luZG93cy93aW4zMi9hbXNpL2hvdy1hbXNpLWhlbHBz&#34;&gt;官方文档&lt;/span&gt;宣称可以对混淆 PowerShell 脚本最终的无混淆结果进行检测，为了知道 AMSI 运行中具体对脚本的哪些内容进行了捕获检测，我们尝试截获输出传给 AMSI 的脚本内容。主要参考了 YouTube 上的一个&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1qaXhjTmotTWM0MA==&#34;&gt;技术视频&lt;/span&gt;进行了实现。&lt;/p&gt;
&lt;h1 id=&#34;具体做法&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#具体做法&#34;&gt;#&lt;/a&gt; 具体做法&lt;/h1&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;使用 &lt;code&gt;logman&lt;/code&gt;  创建和控制事件跟踪进程&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; 每一次监控，可以更改名称 AMSITraceTest.etl&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; 开始跟踪&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; start 开始 -ets 直接向事件跟踪会话发送命令，无需保存或调度&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;meta&#34;&gt;#&lt;/span&gt;&lt;span class=&#34;bash&#34;&gt; --% 告诉powershell 停止解释内联PS代码的命令行&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;logman --% start AMSITraceTest -p Microsoft-Antimalware-Scan-Interface (Event1) 0x4 -o AMSITraceTest.etl -ets&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;执行 PowerShell 脚本&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;结束跟踪&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;logman stop AMSITraceTest -ets&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;读取事件内容&lt;/p&gt;
&lt;p&gt;编写一个 &lt;code&gt;GetAMSI.ps1&lt;/code&gt; , 然后导入  &lt;code&gt;. GetAMSI.ps1&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight powershell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;32&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;function&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;function&lt;/span&gt; &lt;span class=&#34;title&#34;&gt;Get-AMSITraceEvent&lt;/span&gt;&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;keyword&#34;&gt;param&lt;/span&gt; (&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    [&lt;span class=&#34;type&#34;&gt;Parameter&lt;/span&gt;(&lt;span class=&#34;type&#34;&gt;Mandatory&lt;/span&gt;)]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    [&lt;span class=&#34;built_in&#34;&gt;String&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$FilePath&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  )&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &lt;span class=&#34;built_in&#34;&gt;Get-WinEvent&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-Path&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$FilePath&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-Oldest&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-FilterXPath&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;*[System[EventID = 1101]]&amp;#x27;&lt;/span&gt; | &lt;span class=&#34;built_in&#34;&gt;ForEach-Object&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;switch&lt;/span&gt; (&lt;span class=&#34;variable&#34;&gt;$_&lt;/span&gt;.Properties[&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;].Value) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt; &amp;#123; &lt;span class=&#34;variable&#34;&gt;$ScanResult&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;AMSI_RESULT_CLEAN&amp;#x27;&lt;/span&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt; &amp;#123; &lt;span class=&#34;variable&#34;&gt;$ScanResult&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;AMSI_RESULT_NOT_DETECTED&amp;#x27;&lt;/span&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      &lt;span class=&#34;number&#34;&gt;32768&lt;/span&gt; &amp;#123; &lt;span class=&#34;variable&#34;&gt;$ScanResult&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;AMSI_RESULT_DETECTED&amp;#x27;&lt;/span&gt; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      default &amp;#123; &lt;span class=&#34;variable&#34;&gt;$ScanResult&lt;/span&gt; = &lt;span class=&#34;variable&#34;&gt;$_&lt;/span&gt;.Properties[&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;].Value &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$ObjectProperties&lt;/span&gt; = [&lt;span class=&#34;type&#34;&gt;Ordered&lt;/span&gt;] &lt;span class=&#34;selector-tag&#34;&gt;@&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      TimeCreated = &lt;span class=&#34;variable&#34;&gt;$_&lt;/span&gt;.TimeCreated&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      ProcessId = &lt;span class=&#34;variable&#34;&gt;$_&lt;/span&gt;.ProcessId&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      ThreadId = &lt;span class=&#34;variable&#34;&gt;$_&lt;/span&gt;.ThreadId&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      Session = &lt;span class=&#34;variable&#34;&gt;$_&lt;/span&gt;.Properties[&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;].Value&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      ScanStatus = &lt;span class=&#34;variable&#34;&gt;$_&lt;/span&gt;.Properties[&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;].Value&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      ScanResult = &lt;span class=&#34;variable&#34;&gt;$ScanResult&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      AppName = &lt;span class=&#34;variable&#34;&gt;$_&lt;/span&gt;.Properties[&lt;span class=&#34;number&#34;&gt;3&lt;/span&gt;].Value&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      ContentName = &lt;span class=&#34;variable&#34;&gt;$_&lt;/span&gt;.Properties[&lt;span class=&#34;number&#34;&gt;4&lt;/span&gt;].Value&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      ContentSize = &lt;span class=&#34;variable&#34;&gt;$_&lt;/span&gt;.Properties[&lt;span class=&#34;number&#34;&gt;5&lt;/span&gt;].Value&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      OriginalSize = &lt;span class=&#34;variable&#34;&gt;$_&lt;/span&gt;.Properties[&lt;span class=&#34;number&#34;&gt;6&lt;/span&gt;].Value&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      Content = ([&lt;span class=&#34;type&#34;&gt;Text.Encoding&lt;/span&gt;]::Unicode.GetString(&lt;span class=&#34;variable&#34;&gt;$_&lt;/span&gt;.Properties[&lt;span class=&#34;number&#34;&gt;7&lt;/span&gt;].Value))&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      Hash = ((&lt;span class=&#34;variable&#34;&gt;$_&lt;/span&gt;.Properties[&lt;span class=&#34;number&#34;&gt;8&lt;/span&gt;].Value | % &amp;#123; &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#123;0:X2&amp;#125;&amp;#x27;&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;-f&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$_&lt;/span&gt; &amp;#125;) &lt;span class=&#34;operator&#34;&gt;-join&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;      ContentFiltered = &lt;span class=&#34;variable&#34;&gt;$_&lt;/span&gt;.Properties[&lt;span class=&#34;number&#34;&gt;9&lt;/span&gt;].Value&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;built_in&#34;&gt;New-Object&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-TypeName&lt;/span&gt; psobject &lt;span class=&#34;literal&#34;&gt;-Property&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$ObjectProperties&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;然后在 powershell 中执行&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Get-AMSITraceEvent -FilePath ./AMSITraceTest.etl&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ol&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://snowroll.github.io/powershell-2/</guid>
            <title>powershell多线程超时</title>
            <link>https://snowroll.github.io/powershell-2/</link>
            <category>powershell</category>
            <pubDate>Mon, 10 Jan 2022 12:54:31 +0000</pubDate>
            <description><![CDATA[ &lt;h3 id=&#34;内容摘要&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#内容摘要&#34;&gt;#&lt;/a&gt; 内容摘要&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;PowerShell 超时退出&lt;/li&gt;
&lt;li&gt;PowerShell 多线程&lt;/li&gt;
&lt;/ul&gt;
&lt;a id=&#34;more&#34;&gt;&lt;/a&gt;
&lt;h3 id=&#34;1-powershell多线程&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#1-powershell多线程&#34;&gt;#&lt;/a&gt; 1. PowerShell 多线程&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;PowerShell 超时退出&lt;/p&gt;
&lt;p&gt;当我们重复执行某一项程序时，当程序在规定时间内没有返回结果时，我们需要杀死它以开始下一轮的迭代。这时就需要用到超时退出。在 PowerShell 脚本中又如何实现呢？&lt;/p&gt;
&lt;p&gt;我们需要用到 &lt;code&gt;Start-Process&lt;/code&gt;  和 &lt;code&gt;Wait-Process&lt;/code&gt;  来控制子进程的执行时间以实现超时退出。&lt;/p&gt;
&lt;p&gt;示例：&lt;/p&gt;
&lt;figure class=&#34;highlight powershell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;for&lt;/span&gt; (&lt;span class=&#34;variable&#34;&gt;$i&lt;/span&gt;=&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;; &lt;span class=&#34;variable&#34;&gt;$i&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;-le&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$max_iterations&lt;/span&gt;; &lt;span class=&#34;variable&#34;&gt;$i&lt;/span&gt;++)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;variable&#34;&gt;$proc&lt;/span&gt; = &lt;span class=&#34;built_in&#34;&gt;Start-Process&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-filePath&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$programtorun&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-ArgumentList&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$argumentlist&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-workingdirectory&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$programtorunpath&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-PassThru&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;# wait up to x seconds for normal termination&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;built_in&#34;&gt;Wait-Process&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-Timeout&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;300&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-Name&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$programname&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;# if not exited, kill process&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt;(!&lt;span class=&#34;variable&#34;&gt;$proc&lt;/span&gt;.hasExited) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;built_in&#34;&gt;echo&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;quot;kill the process&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;comment&#34;&gt;#$proc.Kill() &amp;lt;- not working if proc is crashed&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;        &lt;span class=&#34;built_in&#34;&gt;Start-Process&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-filePath&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;quot;taskkill.exe&amp;quot;&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-Wait&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-ArgumentList&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;/F&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;string&#34;&gt;&amp;#x27;/IM&amp;#x27;&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$fullprogramname&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;comment&#34;&gt;# this is where I want to use exit code but it comes in empty&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &lt;span class=&#34;keyword&#34;&gt;if&lt;/span&gt; (&lt;span class=&#34;variable&#34;&gt;$proc&lt;/span&gt;.ExitCode &lt;span class=&#34;operator&#34;&gt;-ne&lt;/span&gt; &lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;       &lt;span class=&#34;comment&#34;&gt;# update internal error counters based on result&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ul&gt;
 ]]></description>
        </item>
        <item>
            <guid isPermalink="true">https://snowroll.github.io/powershell-1/</guid>
            <title>powershell技巧连载（一） —— 文件相关操作</title>
            <link>https://snowroll.github.io/powershell-1/</link>
            <category>powershell</category>
            <pubDate>Wed, 20 Oct 2021 04:00:38 +0000</pubDate>
            <description><![CDATA[ &lt;h3 id=&#34;内容摘要&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#内容摘要&#34;&gt;#&lt;/a&gt; 内容摘要&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;文件路径操作&lt;/li&gt;
&lt;li&gt;文件读写操作&lt;/li&gt;
&lt;li&gt;其他文件相关操作&lt;/li&gt;
&lt;/ul&gt;
&lt;a id=&#34;more&#34;&gt;&lt;/a&gt;
&lt;p&gt;####1. 文件路径操作&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;获取当前文件的绝对路径&lt;/p&gt;
&lt;figure class=&#34;highlight powershell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 方法1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;(&lt;span class=&#34;built_in&#34;&gt;Get-Item&lt;/span&gt; test.txt).FullName&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 方法2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;(&lt;span class=&#34;built_in&#34;&gt;Get-Childitem&lt;/span&gt; test.txt).FullName&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;结果&lt;/p&gt;
&lt;figure class=&#34;highlight plain&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;\Users\root\Desktop\test.txt&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;获取文件所在目录路径&lt;/p&gt;
&lt;figure class=&#34;highlight powershell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 方法1: 通过文件系统获取&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;(&lt;span class=&#34;built_in&#34;&gt;Get-Item&lt;/span&gt; test.txt).Directory.FullName&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;(&lt;span class=&#34;built_in&#34;&gt;Get-Childitem&lt;/span&gt; test.txt).Directory.FullName&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 方法2: 利用split-path 切割路径&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$filePath&lt;/span&gt; = (&lt;span class=&#34;built_in&#34;&gt;Get-Item&lt;/span&gt; test.txt).FullName&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;Split-Path&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$filePath&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# split-path 获取文件名&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;Split-Path&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$filePath&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-Leaf&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;结果&lt;/p&gt;
&lt;figure class=&#34;highlight plain&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;\Users\root\Desktop&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;判断当前路径是文件还是文件夹&lt;/p&gt;
&lt;figure class=&#34;highlight powershell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$path&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;\Users\root\Desktop&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 方法1 Test-Path&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;Test-Path&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$path&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-PathType&lt;/span&gt; Container&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;Test-Path&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$path&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-PathType&lt;/span&gt; Leaf&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 方法3 Get-Item&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;(&lt;span class=&#34;built_in&#34;&gt;Get-Item&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$path&lt;/span&gt;) &lt;span class=&#34;operator&#34;&gt;-is&lt;/span&gt; [&lt;span class=&#34;type&#34;&gt;IO.fileinfo&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;(&lt;span class=&#34;built_in&#34;&gt;Get-Item&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$path&lt;/span&gt;) &lt;span class=&#34;operator&#34;&gt;-is&lt;/span&gt; [&lt;span class=&#34;type&#34;&gt;IO.DirectoryInfo&lt;/span&gt;]&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 方法2 System.IO 最快&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[&lt;span class=&#34;type&#34;&gt;System.IO.Directory&lt;/span&gt;]::Exists(&lt;span class=&#34;variable&#34;&gt;$path&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[&lt;span class=&#34;type&#34;&gt;System.IO.File&lt;/span&gt;]::Exits(&lt;span class=&#34;variable&#34;&gt;$path&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;相对路径转换为绝对路径&lt;/p&gt;
&lt;figure class=&#34;highlight powershell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;(&lt;span class=&#34;built_in&#34;&gt;Resolve-Path&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;./&amp;#x27;&lt;/span&gt;).Path&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;结果&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;\Users\root\Desktop&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;获取文件夹下所有文件&lt;/p&gt;
&lt;figure class=&#34;highlight powershell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 获取当前目录下所有文件名&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;(&lt;span class=&#34;built_in&#34;&gt;Get-Childitem&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;./&amp;#x27;&lt;/span&gt;).Name&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 获取当前目录下所有文件的绝对路径&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;(&lt;span class=&#34;built_in&#34;&gt;Get-Childitem&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;./&amp;#x27;&lt;/span&gt;).FullName&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;结果&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;test.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;demo.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;\Users\root\Desktop\test.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;\Users\root\Desktop\demo.txt&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Tips： 测试代码运行时间&lt;/p&gt;
&lt;figure class=&#34;highlight powershell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;Measure-Command&lt;/span&gt; &amp;#123;Command or a code block&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# example&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;Measure-Command&lt;/span&gt; &amp;#123;&lt;span class=&#34;built_in&#34;&gt;Test-Path&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;./test.txt&amp;#x27;&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-PathType&lt;/span&gt; Leaf&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;结果&lt;/p&gt;
&lt;figure class=&#34;highlight shell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Days              : 0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Hours             : 0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Minutes           : 0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Seconds           : 0&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Milliseconds      : 1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;Ticks             : 12989&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;TotalDays         : 1.50335648148148E-08&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;TotalHours        : 3.60805555555556E-07&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;TotalMinutes      : 2.16483333333333E-05&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;TotalSeconds      : 0.0012989&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;TotalMilliseconds : 1.2989&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;####2. 文件读写操作&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;读文件&lt;/p&gt;
&lt;figure class=&#34;highlight powershell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 按行读入，得到一个数组&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$content&lt;/span&gt; = &lt;span class=&#34;built_in&#34;&gt;Get-Content&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;test.txt&amp;#x27;&lt;/span&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 一次性读入所有的文件&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$content&lt;/span&gt; = &lt;span class=&#34;built_in&#34;&gt;Get-Content&lt;/span&gt; &lt;span class=&#34;string&#34;&gt;&amp;#x27;test.txt&amp;#x27;&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-Raw&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$content&lt;/span&gt; = [&lt;span class=&#34;type&#34;&gt;io.file&lt;/span&gt;]::ReadAllLines(&lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;写文件&lt;/p&gt;
&lt;figure class=&#34;highlight powershell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$content&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;Hello World!&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt; = &lt;span class=&#34;string&#34;&gt;&amp;#x27;test.txt&amp;#x27;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 方法1 Out-File 通过管道（比较慢）&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$content&lt;/span&gt; | &lt;span class=&#34;built_in&#34;&gt;Out-File&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 方法2 Out-File&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;Out-File&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-InputObject&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$content&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 方法3 io.file&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;[&lt;span class=&#34;type&#34;&gt;io.file&lt;/span&gt;]::WriteAllLines(&lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt;, &lt;span class=&#34;variable&#34;&gt;$content&lt;/span&gt;, [&lt;span class=&#34;type&#34;&gt;text.encoding&lt;/span&gt;]::Unicode)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 方法4 Set-Content&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;Set-Content&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-Value&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$content&lt;/span&gt; &lt;span class=&#34;literal&#34;&gt;-Encoding&lt;/span&gt; Unicode&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;comment&#34;&gt;# 方法5 命令行操作&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$content&lt;/span&gt; &amp;gt; &lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;####3. 其他文件相关操作&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;文件复制&lt;/p&gt;
&lt;figure class=&#34;highlight powershell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;Copy-Item&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$srcFile&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$dstFile&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;文件移动&lt;/p&gt;
&lt;figure class=&#34;highlight powershell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;Move-Item&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$srcFile&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$dstFile&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;文件删除&lt;/p&gt;
&lt;figure class=&#34;highlight powershell&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;Remove-Item&lt;/span&gt; &lt;span class=&#34;variable&#34;&gt;$file&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;center&gt;To say goodbye is to die a little.
&lt;p align=&#34;right&#34;&gt;——《The Long Goodbye》 ]]></description>
        </item>
    </channel>
</rss>
